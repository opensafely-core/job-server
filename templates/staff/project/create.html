{% extends "staff/base.html" %}

{% load django_vite %}

{% block metatitle %}Create a project: Staff Area | OpenSAFELY Jobs{% endblock metatitle %}

{% block breadcrumbs %}
  {% #breadcrumbs %}
    {% url "staff:index" as staff_url %}
    {% url "staff:project-list" as staff_project_list_url %}
    {% breadcrumb title="Staff area" url=staff_url %}
    {% breadcrumb title="Projects" url=staff_project_list_url %}
    {% breadcrumb title="Create a project" active=True %}
  {% /breadcrumbs %}
{% endblock breadcrumbs %}

{% block hero %}
  {% staff_hero title="Create a project" %}
{% endblock hero %}

{% block content %}
  <form method="POST" class="max-w-3xl flex flex-col gap-y-6">
    {% csrf_token %}

    {% if form.non_field_errors or form.errors %}
      {% #alert variant="danger" %}
        <ul>
          {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}

          {% for field in form %}
            {% if field.errors %}
              <li>
                <strong>{{ field.label }}:</strong>
                <ul>
                  {% for error in field.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                </ul>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      {% /alert %}
    {% endif %}

    {% #card title="Project information" container=True %}
      {% #form_fieldset class="w-full items-stretch gap-y-6" %}
        {% form_legend text="Project information" class="sr-only" %}
        {% form_input field=form.number %}
        {% form_input field=form.name %}
      {% /form_fieldset %}
    {% /card %}

    {% #card title="Job Server information" container=True %}
      {% #form_fieldset class="w-full items-stretch gap-y-6" %}
        {% form_legend text="Job Server information" class="sr-only" %}
        {% form_select field=form.fields.orgs choices=form.fields.orgs.choices selected=form.orgs.value.0 id="id_orgs" name="orgs" label="Link project to an organisation" hint_text="This is the sponsoring organisation, found in Section 9 of the NHSE OpenSAFELY Project Application form." hint_extra_class="max-w-full" %}
        {% form_select field=form.status choices=form.fields.status.choices selected=form.status.value hint_text="This is automatically generated and cannot be changed until the project has been created." hint_extra_class="max-w-full" disabled=True %}
        {% form_input custom_field=True id="id_created_at" name="created_at" value=form.created_at.value|date:"Y-m-d" errors=form.created_at.errors type="date" label="Project created at" hint_text="This is automatically set to today's date, and cannot be changed." disabled=True %}
        {% form_input custom_field=True id="id_created_by" name="created_by" field=form.created_by value=user.get_full_name label="Project created by" hint_text="This is automatically set to the user completing the form, and cannot be changed." disabled=True %}
      {% /form_fieldset %}
    {% /card %}

    {% #card title="Co-pilot details" container=True %}
      {% #form_fieldset class="w-full items-stretch gap-y-6" %}
        {% form_legend text="Co-pilot details" class="sr-only" %}
        {% form_select field=form.copilot choices=form.fields.copilot.choices selected=form.copilot.value label="Project Co-pilot" hint_text="Ask the BI Co-pilot Lead to find out who is Co-piloting this new project."%}
      {% /form_fieldset %}
    {% /card %}


    {% #button variant="success" type="submit" class="self-start" %}
      Save
    {% /button %}
  </form>
{% endblock content %}

{% block extra_js %}
  {% vite_asset "templates/_components/multiselect/multiselect.js" %}
{% endblock extra_js %}
