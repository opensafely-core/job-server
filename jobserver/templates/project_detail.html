{% extends "base.html" %}

{% load humanize %}

{% block content %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">

    <li class="breadcrumb-item"><a href="/">Home</a></li>

    <li class="breadcrumb-item">
      <a href="{{ project.org.get_absolute_url }}">
        {{ project.org.name }}
      </a>
    </li>

    <li class="breadcrumb-item active" aria-current="page">{{ project.name }}</li>

  </ol>
</nav>

<div class="row">
  <div class="col-lg-10 offset-lg-1">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>{{ project.name }}</h2>

      {% if can_manage_members %}
      <a class="btn btn-sm btn-primary" href="{% url 'project-settings' org_slug=project.org.slug project_slug=project.slug %}">
        Settings
      </a>
      {% endif %}
    </div>

    <div class="mb-4">
      {% if project.description %}
      <p>{{ project.description }}
      {% endif %}

      <p>
        This is an OpenSAFELY project. Every time a researcher runs their
        analytic code against patient data, it is audited in public here. Use
        the "logs" buttons below to explore more.
      </p>
    </div>

    <div class="row">

      <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center">
          <h3>Workspaces</h3>

          {% if can_manage_workspaces %}
          <a class="btn btn-sm btn-primary" href="{% url 'workspace-create' org_slug=project.org.slug project_slug=project.slug %}">
            Create a Workspace
          </a>
          {% endif %}
        </div>

        <ul class="list-unstyled">
          {% for workspace in workspaces %}
          <li class="d-flex justify-content-between align-items-center border rounded mb-3 p-2">

            <div>
              <a href="{{ workspace.get_absolute_url }}">
                {{ workspace.name }}
              </a>
            </div>

            <a class="btn btn-sm btn-primary" href="{{ workspace.get_logs_url }}">Logs</a>

          </li>
          {% endfor %}
        </ul>
      </div>

      <div class="col-lg-4">

        <div class="mb-4">
          <h5>Repos</h5>
          <ul class="list-unstyled">
            {% for repo in repos %}
            <li class="d-flex align-items-center">
              <a href="{{ repo.url }}">{{ repo.name }}</a>
              <span class="badge badge-secondary ml-1">
                {% if repo.is_private %}Private{% else %}Public{% endif %}
              </span>
            </li>
            {% endfor %}
          </ul>
        </div>

        <div class="mb-4">
          <h5>Created</h5>
          <span title="{{ project.created_at|date:"Y-m-d H:i:s" }}">
            {{ project.created_at|naturaltime }}
          </span>

        </div>

        <div class="mb-4">
          <h5>Organisation</h5>
          <a href="{{ project.org.get_absolute_url }}">{{ project.org.name }}</a>
        </div>

        <div class="mb-4">
          <h5>Researchers</h5>
          <ul class="list-unstyled">
            {% for user in project.members.all %}
            <li>{{ user.name }}</li>
            {% endfor %}
          </ul>
        </div>

        {% if can_use_releases %}
        <div class="mb-4">
          <h5>Outputs</h5>

          <ul class="list-unstyled">
            {% for snapshot in outputs %}
            <li>
              <a class="mr-3" href="{{ snapshot.get_absolute_url }}">
                Published on {{ snapshot.created_at|date:"Y-m-d" }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

      </div>

    </div>

  </div>
</div>
{% endblock %}
